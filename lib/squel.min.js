var squel=function(t){"use strict";function e(t){return t&&t.constructor.prototype===Object.prototype}function s(t){return t&&t.constructor.prototype===Array.prototype}function r(t,...e){if(t&&e)for(const s of e)"object"==typeof s&&Object.getOwnPropertyNames(s).forEach((e=>{t[e]=s[e]}));return t}function i(t){if(!t)return t;if("function"==typeof t.clone)return t.clone();if(e(t)||s(t)){const e=new t.constructor;return Object.getOwnPropertyNames(t).forEach((s=>{"function"!=typeof t[s]&&(e[s]=i(t[s]))})),e}return JSON.parse(JSON.stringify(t))}function n(t){return t&&!!t._toParamString}const a=function(t){return!n(t)||!t.options.rawNesting};function o(t,e){return t.length?t+e:t}function l(t,e,s){const r=typeof e;if("function"!==r&&"string"!==r)throw new Error("type must be a class constructor or string");if("function"!=typeof s)throw new Error("handler must be a function");for(const r of t)if(r.type===e)return void(r.handler=s);t.push({type:e,handler:s})}class u{clone(){return r(new this.constructor,i(r({},this)))}}function h(t,e,s){return c(t,e)||c(t,s)}function c(t,e){for(let s=0;s<e.length;s++){const r=e[s];if(typeof t===r.type||"string"!=typeof r.type&&t instanceof r.type)return r.handler}}const d={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1};class f extends u{constructor(t){super(),this.globalValueHandlers=[];const e=JSON.parse(JSON.stringify(d));["stringFormatter"].forEach((t=>{e[t]=d[t]})),this.options=r({},e,t)}registerValueHandler(t,e){return l(this.options.valueHandlers,t,e),this}_sanitizeExpression(t){if(!n(t)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or builder instance");return t}_sanitizeName(t,e){if("string"!=typeof t)throw new Error(`${e} must be a string`);return t}_sanitizeField(t){return n(t)?t:this._sanitizeName(t,"field name")}_sanitizeBaseBuilder(t){if(n(t))return t;throw new Error("must be a builder instance")}_sanitizeTable(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(t){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}_sanitizeTableAlias(t){return this._sanitizeName(t,"table alias")}_sanitizeFieldAlias(t){return this._sanitizeName(t,"field alias")}_sanitizeLimitOffset(t){if((t=parseInt(t))<0||Number.isNaN(t))throw new Error("limit/offset must be >= 0");return t}_sanitizeValue(t){const e=typeof t;if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(n(t));else{if(!!!h(t,this.options.valueHandlers,this.globalValueHandlers))throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}_escapeValue(t){return this.options.replaceSingleQuotes&&t?t.replace(/'/g,this.options.singleQuoteReplacement):t}_formatTableName(t){if(this.options.autoQuoteTableNames){const e=this.options.nameQuoteCharacter;t=`${e}${t}${e}`}return t}_formatFieldAlias(t){if(this.options.autoQuoteAliasNames){const e=this.options.fieldAliasQuoteCharacter;t=`${e}${t}${e}`}return t}_formatTableAlias(t){if(this.options.autoQuoteAliasNames){const e=this.options.tableAliasQuoteCharacter;t=`${e}${t}${e}`}return this.options.useAsForTableAliasNames?`AS ${t}`:t}_formatFieldName(t,e={}){if(this.options.autoQuoteFieldNames){const s=this.options.nameQuoteCharacter;t=e.ignorePeriodsForFieldNameQuotes?`${s}${t}${s}`:t.toString().split(".").map((t=>"*"===t?t:`${s}${t}${s}`)).join(".")}return t}_formatCustomValue(t,e,s={}){const r=h(t,this.options.valueHandlers,this.globalValueHandlers);return r&&(t=r(t,e,s))&&t.rawNesting?{formatted:!0,rawNesting:!0,value:t.value}:{formatted:!!r,value:t}}_formatValueForParamArray(t,e={}){return s(t)?t.map((t=>this._formatValueForParamArray(t,e))):this._formatCustomValue(t,!0,e).value}_formatValueForQueryString(t,e={}){let{rawNesting:r,formatted:i,value:o}=this._formatCustomValue(t,!1,e);if(i)return r?o:this._applyNestingFormatting(o,a(t));if(s(o))o=o.map((t=>this._formatValueForQueryString(t))),o=this._applyNestingFormatting(o.join(", "),a(o));else{const t=typeof o;if(null===o)o="NULL";else if("boolean"===t)o=o?"TRUE":"FALSE";else if(n(o))o=this._applyNestingFormatting(o.toString(),a(o));else if("number"!==t){if("string"===t&&this.options.stringFormatter)return this.options.stringFormatter(o);if(e.dontQuote)o=`${o}`;else{o=`'${this._escapeValue(o)}'`}}}return o}_applyNestingFormatting(t,e=!0){if(t&&"string"==typeof t&&e&&!this.options.rawNesting){let e="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(e){let s=0,r=1;for(;t.length-1>++s;){const i=t.charAt(s);if("("===i)r++;else if(")"===i&&(r--,r<1)){e=!1;break}}}e||(t=`(${t})`)}return t}_buildString(t,e,r={}){const{nested:i,buildParameterized:a,formattingOptions:o}=r;e=e||[],t=t||"";let l="",u=-1;const h=[],c=this.options.parameterCharacter;let d=0;for(;t.length>d;)if(t.substr(d,c.length)===c){let t=e[++u];if(a)if(n(t)){const e=t._toParamString({buildParameterized:a,nested:!0});l+=e.text,e.values.forEach((t=>h.push(t)))}else if(t=this._formatValueForParamArray(t,o),s(t)){l+=`(${t.map((()=>c)).join(", ")})`,t.forEach((t=>h.push(t)))}else l+=c,h.push(t);else l+=this._formatValueForQueryString(t,o);d+=c.length}else l+=t.charAt(d),d++;return{text:this._applyNestingFormatting(l,!!i),values:h}}_buildManyStrings(t,e,s={}){const r=[],i=[];for(let n=0;t.length>n;++n){const a=t[n],o=e[n],{text:l,values:u}=this._buildString(a,o,{buildParameterized:s.buildParameterized,nested:!1});r.push(l),u.forEach((t=>i.push(t)))}const n=r.join(this.options.separator);return{text:n.length?this._applyNestingFormatting(n,!!s.nested):"",values:i}}toString(t={}){return this._toParamString(t).text}toParam(t={}){return this._toParamString(r({},t,{buildParameterized:!0}))}}class p extends f{constructor(t){super(t),this._nodes=[]}and(t,...e){return t=this._sanitizeExpression(t),this._nodes.push({type:"AND",expr:t,para:e}),this}or(t,...e){return t=this._sanitizeExpression(t),this._nodes.push({type:"OR",expr:t,para:e}),this}_toParamString(t={}){const e=[],s=[];for(const r of this._nodes){const{type:i,expr:a,para:o}=r,{text:l,values:u}=n(a)?a._toParamString({buildParameterized:t.buildParameterized,nested:!0}):this._buildString(a,o,{buildParameterized:t.buildParameterized});e.length&&e.push(i),e.push(l),u.forEach((t=>s.push(t)))}const r=e.join(" ");return{text:this._applyNestingFormatting(r,!!t.nested),values:s}}}class _ extends f{constructor(t,s={}){super(s),e(t)&&(s=t,t=null),t&&(this._fieldName=this._sanitizeField(t)),this.options=r({},d,s),this._cases=[],this._elseValue=null}when(t,...e){return this._cases.unshift({expression:t,values:e||[]}),this}then(t){if(0===this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}else(t){return this._elseValue=t,this}_toParamString(t={}){let e="";const s=[];for(const{expression:r,values:i,result:n}of this._cases){e=o(e," ");const a=this._buildString(r,i,{buildParameterized:t.buildParameterized,nested:!0});e+=`WHEN ${a.text} THEN ${this._formatValueForQueryString(n)}`,a.values.forEach((t=>s.push(t)))}return e.length?(e+=` ELSE ${this._formatValueForQueryString(this._elseValue)} END`,this._fieldName&&(e=`${this._fieldName} ${e}`),e=`CASE ${e}`):e=this._formatValueForQueryString(this._elseValue),{text:e,values:s}}}class m extends f{constructor(t,e){super(t),this.blocks=e||[];for(const t of this.blocks){const e=t.exposedMethods();for(const s in e){const r=e[s];if(void 0!==this[s])throw new Error(`Builder already has a builder method called: ${s}`);((t,e,s)=>{this[e]=(...e)=>(s.call(t,...e),this)})(t,s,r)}}}registerValueHandler(t,e){for(const s of this.blocks)s.registerValueHandler(t,e);return super.registerValueHandler(t,e),this}updateOptions(t){this.options=r({},this.options,t);for(const e of this.blocks)e.options=r({},e.options,t)}_toParamString(t={}){t=r({},this.options,t);const e=this.blocks.map((e=>e._toParamString({buildParameterized:t.buildParameterized,queryBuilder:this}))),s=e.map((t=>t.text)),i=e.map((t=>t.values));let n=s.filter((t=>t.length>0)).join(t.separator);const a=[];if(i.forEach((t=>t.forEach((t=>a.push(t))))),!t.nested&&t.numberedParameters){let e=void 0!==t.numberedParametersStartAt?t.numberedParametersStartAt:1;const s=t.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|*\s]/g,"\\$&");n=n.replace(new RegExp(s,"g"),(()=>`${t.numberedParametersPrefix}${e++}`))}return{text:this._applyNestingFormatting(n,!!t.nested),values:a}}clone(){const t=this.blocks.map((t=>t.clone()));return new this.constructor(this.options,t)}getBlock(t){return this.blocks.filter((e=>e instanceof t))[0]}}class g extends f{constructor(t){super(t)}exposedMethods(){const t={};let e=this;for(;e;)Object.getOwnPropertyNames(e).forEach((s=>{"constructor"===s||"function"!=typeof e[s]||"_"===s.charAt(0)||g.prototype[s]||(t[s]=e[s])})),e=Object.getPrototypeOf(e);return t}}class b extends g{constructor(t){super(t),this._strings=[],this._values=[]}function(t,...e){return this._strings.push(t),this._values.push(e),this}_toParamString(t={}){return this._buildManyStrings(this._strings,this._values,t)}}class v extends g{constructor(t,e){super(t),this._str=e}_toParamString(t={}){return{text:this._str,values:[]}}}class w extends g{distinct(){return this._useDistinct=!0,this}_toParamString(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}class x extends g{constructor(t,e){super(t),this._tables=[]}_table(t,e=null){e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}_hasTable(){return this._tables.length>0}_toParamString(t={}){let e="";const s=[];if(this._hasTable()){for(const{table:r,alias:i}of this._tables){let a;if(e=o(e,", "),n(r)){const{text:e,values:i}=r._toParamString({buildParameterized:t.buildParameterized,nested:!0});a=e,i.forEach((t=>s.push(t)))}else a=this._formatTableName(r);i&&(a+=` ${this._formatTableAlias(i)}`),e+=a}this.options.prefix&&(e=`${this.options.prefix} ${e}`)}return{text:e,values:s}}}class P extends x{constructor(t){super(r({},t,{prefix:"FROM"}))}from(t,e=null){return this._table(t,e),this}}class S extends g{constructor(t){super(t),this._fields=[]}fields(t,e={}){if(s(t))for(const s of t)this.field(s,null,e);else for(const s in t){const r=t[s];this.field(s,r,e)}return this}field(t,e=null,s={}){e=e?this._sanitizeFieldAlias(e):e,t=this._sanitizeField(t);return this._fields.filter((s=>s.name===t&&s.alias===e)).length||this._fields.push({name:t,alias:e,options:s}),this}_toParamString(t={}){const{queryBuilder:e,buildParameterized:s}=t;let r="";const i=[];for(const t of this._fields){r=o(r,", ");const{name:e,alias:n,options:a}=t;if("string"==typeof e)r+=this._formatFieldName(e,a);else{const t=e._toParamString({nested:!0,buildParameterized:s});r+=t.text,t.values.forEach((t=>i.push(t)))}n&&(r+=` AS ${this._formatFieldAlias(n)}`)}if(!r.length){const t=e&&e.getBlock(P);t&&t instanceof x&&t._hasTable()&&(r="*")}return{text:r,values:i}}}class y extends g{constructor(t){super(t),this._joins=[]}join(t,e=null,s=null,r="INNER"){return t=this._sanitizeTable(t),e=e?this._sanitizeTableAlias(e):e,s=s?this._sanitizeExpression(s):s,this._joins.push({type:r,table:t,alias:e,condition:s}),this}left_join(t,e=null,s=null){return this.join(t,e,s,"LEFT"),this}right_join(t,e=null,s=null){return this.join(t,e,s,"RIGHT"),this}outer_join(t,e=null,s=null){return this.join(t,e,s,"OUTER"),this}left_outer_join(t,e=null,s=null){return this.join(t,e,s,"LEFT OUTER"),this}full_join(t,e=null,s=null){return this.join(t,e,s,"FULL"),this}cross_join(t,e=null,s=null){return this.join(t,e,s,"CROSS"),this}_toParamString(t={}){let e="";const s=[];for(const{type:r,table:i,alias:a,condition:l}of this._joins){let u;if(e=o(e,this.options.separator),n(i)){const e=i._toParamString({buildParameterized:t.buildParameterized,nested:!0});e.values.forEach((t=>s.push(t))),u=e.text}else u=this._formatTableName(i);if(e+=`${r} JOIN ${u}`,a&&(e+=` ${this._formatTableAlias(a)}`),l){let r;e+=" ON ",r=n(l)?l._toParamString({buildParameterized:t.buildParameterized}):this._buildString(l,[],{buildParameterized:t.buildParameterized}),e+=this._applyNestingFormatting(r.text),r.values.forEach((t=>s.push(t)))}}return{text:e,values:s}}}class E extends g{constructor(t){super(t),this._conditions=[]}_condition(t,...e){t=this._sanitizeExpression(t),this._conditions.push({expr:t,values:e||[]})}_toParamString(t={}){const e=[],s=[];for(const{expr:r,values:i}of this._conditions){const a=n(r)?r._toParamString({buildParameterized:t.buildParameterized}):this._buildString(r,i,{buildParameterized:t.buildParameterized});a.text.length&&e.push(a.text),a.values.forEach((t=>s.push(t)))}let r="";return e.length&&(r=e.join(") AND (")),{text:r.length?`${this.options.verb} (${r})`:"",values:s}}}class z extends E{constructor(t){super(r({},t,{verb:"WHERE"}))}where(t,...e){return this._condition(t,...e),this}}class N extends g{constructor(t){super(t),this._groups=[]}group(t){return this._groups.push(this._sanitizeField(t)),this}_toParamString(t={}){return{text:this._groups.length?`GROUP BY ${this._groups.join(", ")}`:"",values:[]}}}class F extends E{constructor(t){super(r({},t,{verb:"HAVING"}))}having(t,...e){return this._condition(t,...e),this}}class $ extends g{constructor(t){super(t),this._orders=[]}order(t,e,...s){t=this._sanitizeField(t);let r=null;return"string"!=typeof e?void 0===e?r="ASC":null!==e&&(r=e?"ASC":"DESC"):r=e,this._orders.push({field:t,dir:r,values:s||[]}),this}_toParamString(t={}){let e="";const r=[];for(const{field:i,dir:n,values:a}of this._orders){e=o(e,", ");const l=this._buildString(i.toString(),a,{buildParameterized:t.buildParameterized});e+=l.text,s(l.values)&&l.values.forEach((t=>r.push(t))),null!==n&&(e+=` ${n}`)}return{text:e.length?`ORDER BY ${e}`:"",values:r}}}class T extends g{constructor(t){super(t),this._value=null}_setValue(t){this._value=null!==t?this._sanitizeLimitOffset(t):t}_toParamString(t={}){const e=null!==this._value?`${this.options.verb} ${this.options.parameterCharacter}`:"",s=null!==this._value?[this._value]:[];return this._buildString(e,s,t)}}class A extends T{constructor(t){super(r({},t,{verb:"LIMIT"}))}limit(t){return this._setValue(t),this}}class O extends T{constructor(t){super(r({},t,{verb:"OFFSET"}))}offset(t){return this._setValue(t),this}}class V extends g{constructor(t){super(t),this._unions=[]}union(t,e="UNION"){return t=this._sanitizeTable(t),this._unions.push({type:e,table:t}),this}union_all(t){return this.union(t,"UNION ALL"),this}_toParamString(t={}){let e="";const s=[];for(const{type:r,table:i}of this._unions){let a;if(e=o(e,this.options.separator),n(i)){const e=i._toParamString({buildParameterized:t.buildParameterized,nested:!0});a=e.text,e.values.forEach((t=>s.push(t)))}else e=this._formatTableName(i);e+=`${r} ${a}`}return{text:e,values:s}}}class j extends g{constructor(t){super(t),this._fields=[],this._query=null}fromQuery(t,e){return this._fields=t.map((t=>this._sanitizeField(t))),this._query=this._sanitizeBaseBuilder(e),this}_toParamString(t={}){let e="",s=[];if(this._fields.length&&this._query){const{text:r,values:i}=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0});e=`(${this._fields.join(", ")}) ${this._applyNestingFormatting(r)}`,s=i}return{text:e,values:s}}}class B extends g{constructor(t){super(t),this._reset()}_reset(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}_set(t,e,s={}){if(this._values.length>1)throw new Error("Cannot set multiple rows of fields this way.");void 0!==e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);let r=this._fields.indexOf(t);-1===r&&(this._fields.push(t),r=this._fields.length-1),this._values[0][r]=e,this._valueOptions[0][r]=s}_setFields(t,e={}){if("object"!=typeof t)throw new Error("Expected an object but got "+typeof t);for(const s in t)this._set(s,t[s],e)}_setFieldsRows(t,e={}){if(!s(t))throw new Error("Expected an array of objects but got "+typeof t);this._reset();for(let r=0;t.length>r;++r){const i=t[r];for(let t in i){let n=i[t];t=this._sanitizeField(t),n=this._sanitizeValue(n);let a=this._fields.indexOf(t);if(r>0&&-1===a)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===a&&(this._fields.push(t),a=this._fields.length-1),s(this._values[r])||(this._values[r]=[],this._valueOptions[r]=[]),this._values[r][a]=n,this._valueOptions[r][a]=e}}}}class Q extends B{set(t,e,s){return this._set(t,e,s),this}setFields(t,e){return this._setFields(t,e),this}setFieldsRows(t,e){return this._setFieldsRows(t,e),this}_toParamString(t={}){const{buildParameterized:e}=t,s=this._fields.map((t=>this._formatFieldName(t))).join(", "),r=[],i=[];for(let t=0;t<this._values.length;++t){r[t]="";for(let s=0;s<this._values[t].length;++s){const n=this._buildString(this.options.parameterCharacter,[this._values[t][s]],{buildParameterized:e,formattingOptions:this._valueOptions[t][s]});n.values.forEach((t=>i.push(t))),r[t]=o(r[t],", "),r[t]+=n.text}}return{text:s.length?`(${s}) VALUES (${r.join("), (")})`:"",values:i}}}class k extends x{constructor(t){super(r({},t,{prefix:"INTO",singleTable:!0}))}into(t){return this._table(t),this}_toParamString(t={}){if(!this._hasTable())throw new Error("into() needs to be called");return super._toParamString(t)}}class C extends x{target(t){return this._table(t),this}}class H extends m{constructor(t,e=null){super(t,e=e||[new v(t,"SELECT"),new b(t),new w(t),new S(t),new P(t),new y(t),new z(t),new N(t),new F(t),new $(t),new A(t),new O(t),new V(t)])}}class R extends B{set(t,e,s){return this._set(t,e,s),this}setFields(t,e){return this._setFields(t,e),this}_toParamString(t={}){const{buildParameterized:e}=t;if(this._fields.length<=0)throw new Error("set() needs to be called");let s="";const r=[];for(let t=0;t<this._fields.length;++t){s=o(s,", ");let i=this._formatFieldName(this._fields[t]).toString();const n=this._values[0][t];i.indexOf("=")<0&&(i=`${i} = ${this.options.parameterCharacter}`);const a=this._buildString(i,[n],{buildParameterized:e,formattingOptions:this._valueOptions[0][t]});s+=a.text,a.values.forEach((t=>r.push(t)))}return{text:`SET ${s}`,values:r}}}class I extends x{table(t,e=null){return this._table(t,e),this}_toParamString(t={}){if(!this._hasTable())throw new Error("table() needs to be called");return super._toParamString(t)}}class L extends m{constructor(t,e=null){super(t,e=e||[new v(t,"UPDATE"),new I(t),new R(t),new z(t),new $(t),new A(t)])}}class D extends m{constructor(t,e=null){super(t,e=e||[new v(t,"INSERT"),new k(t),new Q(t),new j(t)])}}class U extends m{constructor(t,e=null){super(t,e=e||[new v(t,"DELETE"),new C(t),new P(r({},t,{singleTable:!0})),new y(t),new z(t),new $(t),new A(t)])}}class q{constructor(t){this.flavour=null,this.flavours={},this.globalValueHandlers=[],this.VERSION="1.0.0",this.remove=this.delete,this.flavour=t||null,this.registerValueHandler(b,(function(t,e=!1){return e?t.toParam():t.toString()}))}registerValueHandler(t,e){l(this.globalValueHandlers,t,e)}expr(t){return new p(t)}case(t,e){return new _(t,e)}select(t,e){return new H(t,e)}update(t,e){return new L(t,e)}insert(t,e){return new D(t,e)}delete(t,e){return new U(t,e)}str(...t){const e=new b({});return e.function(t[0],...t.slice(1)),e}rstr(...t){const e=new b({rawNesting:!0});return e.function(t[0],...t.slice(1)),e}useFlavour(t=null){if(!t)return this;if(this.flavours[t]instanceof Function){const e=new q(t);return this.flavours[t].call(null,e),e.flavours=this.flavours,e.useFlavour=this.useFlavour,e}throw new Error(`Flavour not available: ${t}`)}}const M=new q;return t.BaseBuilder=f,t.Block=g,t.Cloneable=u,t.DefaultQueryBuilderOptions=d,t.DistinctBlock=w,t.FromTableBlock=P,t.FunctionBlock=b,t.GetFieldBlock=S,t.GroupByBlock=N,t.HavingBlock=F,t.InsertFieldValueBlock=Q,t.InsertFieldsFromQueryBlock=j,t.IntoTableBlock=k,t.JoinBlock=y,t.LimitBlock=A,t.OffsetBlock=O,t.OrderByBlock=$,t.QueryBuilder=m,t.StringBlock=v,t.TargetTableBlock=C,t.UnionBlock=V,t.WhereBlock=z,t.default=M,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
